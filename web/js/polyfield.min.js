<<<<<<< HEAD

(function(){var a,b=[].indexOf||function(e){for(var d=0,c=this.length;d<c;d++){if(d in this&&this[d]===e){return d}}return -1};a=(function(){c.prototype.types={STRING:"string",DROPDOWN:"dropdown",DATE:"date",TEXT_BLOCK:"editor"};c.prototype.inputTypes={TEXT:"text",DATE:"date",STRING:"string",BOOLEAN:"boolean",DROPDOWN:"dropdown"};function c(){jQuery("body").on("blur",'input[type="text"]',function(){return jQuery(this).val(jQuery(this).val().trim())});this.i18n={}}c.prototype.models={};c.prototype.completes=[];c.prototype.ordersListener={};c.prototype.push=function(d){if(typeof d!=="object"){return console.log("Bad identifier for polyfield "+d)}d.counter=0;d.existsShowen=d.exists?false:true;this.models[d.id]=d;this.appendExists(d.id);return this.bindEvent(d.id)};c.prototype.bindEvent=function(f){var d,e=this;if(typeof this.models[f]==="undefined"){return console.log("Can not find object for what need to bind event")}d=jQuery("#button_"+f);return d.on("click",function(){e.hideExcess(f);return e.appendTemplate(f)})};c.prototype.hideExcess=function(d){if(jQuery("."+d).length){return jQuery("."+d).collapsible("closeAll")}};c.prototype.generateLabel=function(d,g,e){var f;e=e||"col-xs-4 col-sm-4 col-md-3 col-lg-3";f=document.createElement("label");f.setAttribute("class",""+e+" control-label");f.setAttribute("for",d);f.appendChild(document.createTextNode(g));return f};c.prototype.generateInput=function(g,i,h,e,n,j,l){var f,d,k,m;if(typeof n==="undefined"||!n){n=""}if(typeof j==="undefined"){j="hidden"}if(typeof l==="undefined"){l=false}d=document.createElement("div");d.setAttribute("class","form-group");if(l){d.appendChild(this.generateLabel(h+e,l))}f=document.createElement("div");f.setAttribute("class","col-xs-6 col-sm-6 col-md-7 col-lg-7");k=document.createElement("input");k.setAttribute("type",j);k.setAttribute("name",""+i+"["+e+"]["+h+"]");if(j!=="hidden"){m=h+g+e;k.setAttribute("id",m);this.addToAutocomplete(m,i,h)}if(j==="checkbox"&&n){k.setAttribute("checked","checked")}k.setAttribute("class","form-control");if(j!=="checkbox"){k.setAttribute("value",n)}else{k.setAttribute("value","1")}f.appendChild(k);d.appendChild(f);return d};c.prototype.generateEditor=function(g,j,h,e,p,k,n){var f,d,m,o,l,q,i;if(typeof p==="undefined"){p=""}if(typeof k==="undefined"){k="hidden"}if(typeof n==="undefined"){n=false}d=document.createElement("div");d.setAttribute("class","form-group");if(n){d.appendChild(this.generateLabel(h+e,n,"col-xs-1"))}f=document.createElement("div");f.setAttribute("class","col-xs-9");m=document.createElement("textarea");m.setAttribute("name",""+j+"["+e+"]["+h+"]");o=h+g+e;m.setAttribute("id",o);m.setAttribute("class","form-control");m.appendChild(document.createTextNode(p));f.appendChild(m);if(typeof tinymce==="undefined"){i=document.createElement("script");i.setAttribute("src","tinymce/timymce.min.js");body.appendChild(i);q=document.createElement("script");q.setAttribute("src","tinymce/langs/ru.js");body.appendChild(q)}l=document.createElement("script");l.appendChild(document.createTextNode("tinymce.init({            selector: '#"+o+"',            language: 'ru',            height: 300,            fontsize_formats: '6pt 7pt 8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 24pt 28pt 36pt 40pt 48pt',            plugins: [                'advlist autolink lists link image charmap print preview hr anchor pagebreak',                'searchreplace wordcount visualblocks visualchars code fullscreen',                'insertdatetime media nonbreaking save table contextmenu directionality',                'emoticons template paste textcolor quotes'            ],            toolbar: [                'undo redo | fontsizeselect | bold italic underline                | alignleft aligncenter alignright alignjustify                | bullist numlist outdent indent | link image | forecolor backcolor                | print preview media'            ],            image_advtab: true,            image_class_list: [                {title: 'Р‘РµР· РјР°СЃС€С‚Р°Р±РёСЂРѕРІР°РЅРёСЏ', value: 'no-scale-image'},                {title: 'РЎ РјР°СЃС€С‚Р°Р±РёСЂРѕРІР°РЅРёРµРј', value: 'scale-image'}            ]        });"));f.appendChild(l);d.appendChild(f);return d};c.prototype.generateOptions=function(o,e,h,f,j,m){var d,i,l,p,n,g,k;if(typeof j==="undefined"){j=""}if(typeof d==="undefined"){d=false}f=f||e;if(!m){m="id"}p=document.createDocumentFragment();o=o.sort(function(r,q){var t,s;if(!r[f]){return -1}if(!q[f]){return 1}t=r[f].toUpperCase();s=q[f].toUpperCase();if(t>s){return 1}if(t<s){return -1}return 0});for(g=0,k=o.length;g<k;g++){n=o[g];l=n[e];if(j.length){l=n[j]+" - "+l}i=document.createElement("option");i.setAttribute("value",n[m]);i.appendChild(document.createTextNode(l));if(n[m]===h){i.setAttribute("selected",true)}p.appendChild(i)}return p};c.prototype.generateDropdown=function(s,r,p,m,l,f,u,x,y,v,j){var g,q,o,n,d,k,i,h,t,e,w=this;if(typeof v==="undefined"){v=""}if(typeof u==="undefined"){u=false}if(typeof x==="undefined"){x=false}h=document.createElement("div");g=document.createDocumentFragment();h.setAttribute("class","form-group");h.appendChild(this.generateLabel(p+m,l));q=document.createElement("div");q.setAttribute("class","col-xs-6 col-sm-6 col-md-7 col-lg-7");t=document.createElement("select");t.setAttribute("name",""+r+"["+m+"][id]");t.appendChild(this.generateOptions(f,p,u,y,v,j));e=p+s+m;t.setAttribute("id",e);t.setAttribute("class","form-control");if(x){d=document.createElement("div");d.setAttribute("class","form-group");d.appendChild(this.generateLabel("filter"+m,this.translate("filter")));k=document.createElement("select");k.setAttribute("id","filter"+m);i=f.filter(function(A,z,B){return !A[x]});o=document.createElement("option");o.setAttribute("value",0);o.appendChild(document.createTextNode(this.translate("noFilter")));k.appendChild(o);k.appendChild(this.generateOptions(i,p,null,y,v,j));k.setAttribute("class","form-control");n=q.cloneNode();n.appendChild(k);d.appendChild(n);g.appendChild(d);jQuery(k).on("change",function(){var B,A,z;i=function(I,E,D){var F,G,H,C;I=Number(I);if(I===0){return E}else{F=E.filter(function(J){if(I===Number(J[D])){return true}else{return false}});if(F.length){for(H=0,C=F.length;H<C;H++){G=F[H];F=F.concat(i(G.id,E,D))}}return F}};B=jQuery(k);A=jQuery(t);A.empty();z=i(B.val(),f,x);return t.appendChild(w.generateOptions(z,p,u,y,v,j))})}q.appendChild(t);h.appendChild(q);g.appendChild(h);return g};c.prototype.generateDateInput=function(f,j,g,e,o,k,n){var l,d,m,i,h;if(typeof o==="undefined"){o=""}if(typeof k==="undefined"){k="hidden"}if(typeof n==="undefined"){n=false}d=document.createElement("div");d.setAttribute("class","form-group");if(n){d.appendChild(this.generateLabel(g+e,n))}l=document.createElement("div");l.setAttribute("class","col-lg-5 input-group date");m=document.createElement("input");m.setAttribute("class","form-control");m.setAttribute("type",k);m.setAttribute("name",""+j+"["+e+"]["+g+"]");m.setAttribute("value",o);i=document.createElement("span");i.setAttribute("class","input-group-addon");h=document.createElement("span");h.setAttribute("class","glyphicon glyphicon-calendar");i.appendChild(h);l.appendChild(m);l.appendChild(i);d.appendChild(l);$(l).datetimepicker({locale:"ru",viewMode:"years",format:"YYYY-MM-DD"});return d};c.prototype.generateOrder=function(l,j,e){var h,i,f,d,k,g;d=document.createElement("div");i=document.createDocumentFragment();h="order-"+j;d.setAttribute("class","form-group");d.appendChild(this.generateLabel(j+l+e,this.translate("order")));f=document.createElement("div");f.setAttribute("class","col-lg-offset-1 col-lg-3 text-center");k=document.createElement("select");k.setAttribute("name",""+j+"["+e+"][order]");k.appendChild(this.orderOptions(e));this.updateOrder(h,e);g=j+l+e;k.setAttribute("id",g);k.setAttribute("class","form-control "+h);f.appendChild(k);d.appendChild(f);i.appendChild(d);this.bindOrderListener(h);return i};c.prototype.orderOptions=function(d){var e,f,g,h;e=document.createDocumentFragment();for(f=h=1;1<=d?h<=d:h>=d;f=1<=d?++h:--h){g=document.createElement("option");if(f===d){g.setAttribute("selected","selected")}g.setAttribute("value",f);g.appendChild(document.createTextNode(f));e.appendChild(g)}return e};c.prototype.updateOrder=function(f,d){var e;e=$("."+f);e.each(function(){var m,j,h,l,k,g;m=$(this);h=m.children("option").length;if(h<d){g=[];for(j=l=k=h+1;k<=d?l<=d:l>=d;j=k<=d?++l:--l){g.push(m.append("<option>"+j+"</option>"))}return g}})};c.prototype.bindOrderListener=function(e){var d=this;if(typeof this.ordersListener[e]==="undefined"){$("body").on("focus click","."+e,function(f){return d.ordersListener[e]=f.target.value});$("body").on("change","."+e,function(g){var h,f;f=$(g.target);h=d.ordersListener[e];if(h!==f.val()){return $("."+e).each(function(){var i;i=$(this);if(i.val()===g.target.value&&!i.is(f)){return i.val(h)}})}})}return true};c.prototype.generateCollapsible=function(j,e,d){var i,h,f,g;f=j+d;g="section_"+f;h=document.createElement("div");h.setAttribute("id",g);h.setAttribute("class",j);h.appendChild(document.createTextNode(d+". "+e));h.appendChild(document.createElement("span"));i=document.createElement("div");i.appendChild(document.createTextNode("x"));i.setAttribute("id","exit_"+f);i.setAttribute("class","polyfield-exit");i.setAttribute("title",this.translate("deleteElement"));h.appendChild(i);this.bindClose(f);return h};c.prototype.generateContainer=function(e){var d,f;f=document.createElement("div");f.setAttribute("class","content");f.appendChild(document.createElement("div"));f.appendChild(e);d=document.createElement("div");d.setAttribute("class","");d.appendChild(f);return d};c.prototype.appendTemplate=function(d){var f,e,n,o,k,j,l,i,m,h,g;i=this.models[d];i.counter++;m="section_"+d+i.counter;o=this.generateCollapsible(d,i.label,i.counter);k=document.createElement("p");if(i.order){k.appendChild(this.generateOrder(d,i.name,i.counter))}if(i.attributeTypes){h=i.attributeTypes;for(e in h){f=h[e];l=(function(){switch(false){case f!==this.inputTypes.STRING:return this.generateInput(d,i.name,e,i.counter,"","text",i.attributeLabels[e]);case f!==this.inputTypes.DATE:return this.generateDateInput(d,i.name,e,i.counter,"","text",i.attributeLabels[e]);case f!==this.inputTypes.TEXT:return this.generateEditor(d,i.name,e,i.counter,"","text",i.attributeLabels[e]);case f!==this.inputTypes.BOOLEAN:return this.generateInput(d,i.name,e,i.counter,"","checkbox",i.attributeLabels[e]);case f!==this.inputTypes.DROPDOWN:return this.generateDropdown(d,i.name,i.dropdownAttribute,i.counter,i.attributeLabels[i.dropdownAttribute],i.dropdownValues,"",i.filterAttribute,i.sortAttribute,i.dropdownPrefixAttribute,i.dropdownValueAttribute);default:return document.createElement("div")}}).call(this);k.appendChild(l)}}else{if(i.type===this.types.STRING||i.type===this.types.DATE){g=i.attributes;for(j in g){e=g[j];if(b.call(i.dateAttributes,e)>=0){k.appendChild(this.generateDateInput(d,i.name,e,i.counter,"","text",i.attributeLabels[e]));continue}else{k.appendChild(this.generateInput(d,i.name,e,i.counter,"","text",i.attributeLabels[e]))}}}else{if(i.type===this.types.DROPDOWN){k.appendChild(this.generateDropdown(d,i.name,i.dropdownAttribute,i.counter,i.attributeLabels[i.dropdownAttribute],i.dropdownValues,"",i.filterAttribute,i.sortAttribute,i.dropdownPrefixAttribute,i.dropdownValueAttribute))}}}n=document.createDocumentFragment();n.appendChild(o);n.appendChild(this.generateContainer(k));document.getElementById("content_"+d).appendChild(n);jQuery("#"+m).collapsible({defaultOpen:""+m});return this.bindAutocomplete()};c.prototype.appendExists=function(d){var g,e,s,l,o,n,q,m,i,r,j,p,k,h,f;m=this.models[d];if(m.existsShowen){return}k=m.exists;for(j=0,p=k.length;j<p;j++){i=k[j];m.counter++;r="section_"+d+m.counter;s=this.generateCollapsible(d,m.label,m.counter);o=document.createElement("p");if(m.order){o.appendChild(this.generateOrder(d,m.name,m.counter))}if(m.attributeTypes){h=m.attributeTypes;for(e in h){g=h[e];q=(function(){switch(false){case g!==this.inputTypes.STRING:return this.generateInput(d,m.name,e,m.counter,i[e],"text",m.attributeLabels[e]);case g!==this.inputTypes.DATE:return this.generateDateInput(d,m.name,e,m.counter,i[e],"text",m.attributeLabels[e]);case g!==this.inputTypes.TEXT:return this.generateEditor(d,m.name,e,m.counter,i[e],"text",m.attributeLabels[e]);case g!==this.inputTypes.BOOLEAN:return this.generateInput(d,m.name,e,m.counter,i[e],"checkbox",m.attributeLabels[e]);case g!==this.inputTypes.DROPDOWN:return this.generateDropdown(d,m.name,m.dropdownAttribute,m.counter,m.attributeLabels[m.dropdownAttribute],m.dropdownValues,i[m.dropdownValueAttribute],m.filterAttribute,m.sortAttribute,m.dropdownPrefixAttribute,m.dropdownValueAttribute);default:return document.createElement("div")}}).call(this);o.appendChild(q)}}else{if(m.type===this.types.STRING||m.type===this.types.DATE||m.type===this.types.TEXT_BLOCK){f=m.attributes;for(n in f){e=f[n];if(b.call(m.dateAttributes,e)>=0){o.appendChild(this.generateDateInput(d,m.name,e,m.counter,i[e],"text",m.attributeLabels[e]));continue}else{if(m.type===this.types.TEXT_BLOCK){o.appendChild(this.generateEditor(d,m.name,e,m.counter,i[e],"text",m.attributeLabels[e]))}else{o.appendChild(this.generateInput(d,m.name,e,m.counter,i[e],"text",m.attributeLabels[e]))}}}}else{if(m.type===this.types.DROPDOWN){o.appendChild(this.generateDropdown(d,m.name,m.dropdownAttribute,m.counter,m.attributeLabels[m.dropdownAttribute],m.dropdownValues,i[m.dropdownValueAttribute],m.filterAttribute,m.sortAttribute,m.dropdownPrefixAttribute,m.dropdownValueAttribute))}}}l=document.createDocumentFragment();l.appendChild(s);l.appendChild(this.generateContainer(o));document.getElementById("content_"+d).appendChild(l);jQuery("#"+r).collapsible({defaultOpen:r});this.bindAutocomplete()}return m.existsShowen=true};c.prototype.bindClose=function(e){var d=this;return jQuery("body").on("click","#exit_"+e,function(){if(confirm(d.translate("deleteConfirmation"))){jQuery("#section_"+e).next().remove();return jQuery("#section_"+e).remove()}})};c.prototype.addToAutocomplete=function(e,d,f){return this.completes.push({id:e,modelName:d,attribute:f})};c.prototype.bindAutocomplete=function(){var g,d,f,i,e,h;h=this.completes;for(i=0,e=h.length;i<e;i++){g=h[i];d=jQuery("#"+g.id);if(typeof d==="undefined"){console.error("Bad selector identifier gets for input autocomplete")}f=location.protocol+"//"+location.host+"/content/autocomplete";d.autocomplete({serviceUrl:f,noSuggestionNotice:this.translate("noResults"),deferRequestBy:200,params:{modelName:g.modelName,attributeName:g.attribute}})}return this.completes=[]};c.prototype.setTranslation=function(d){return this.i18n=d};c.prototype.translate=function(d){if(typeof this.i18n[d]!=="undefined"){return this.i18n[d]}else{return d}};return c})();window.polyfield=new a()}).call(this);
=======
var Polyfield,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Polyfield=function(){function e(){jQuery("body").on("blur",'input[type="text"]',function(){return jQuery(this).val(jQuery(this).val().trim())}),this.i18n={}}return e.prototype.types={STRING:"string",DROPDOWN:"dropdown",DATE:"date",TEXT_BLOCK:"editor"},e.prototype.inputTypes={TEXT:"text",DATE:"date",STRING:"string",BOOLEAN:"boolean",DROPDOWN:"dropdown"},e.prototype.models={},e.prototype.completes=[],e.prototype.ordersListener={},e.prototype.push=function(e){return"object"!=typeof e?console.log("Bad identifier for polyfield "+e):(e.counter=0,e.existsShowen=!e.exists,this.models[e.id]=e,this.appendExists(e.id),this.bindEvent(e.id))},e.prototype.bindEvent=function(e){var t;return"undefined"==typeof this.models[e]?console.log("Can not find object for what need to bind event"):(t=jQuery("#button_"+e),t.on("click",function(t){return function(){return t.hideExcess(e),t.appendTemplate(e)}}(this)))},e.prototype.hideExcess=function(e){if(jQuery("."+e).length)return jQuery("."+e).collapsible("closeAll")},e.prototype.generateLabel=function(e,t,n){var r;return n=n||"col-lg-3",r=document.createElement("label"),r.setAttribute("class",n+" control-label"),r.setAttribute("for",e),r.appendChild(document.createTextNode(t)),r},e.prototype.generateInput=function(e,t,n,r,i,o,a){var d,u,p,s;return"undefined"!=typeof i&&i||(i=""),"undefined"==typeof o&&(o="hidden"),"undefined"==typeof a&&(a=!1),u=document.createElement("div"),u.setAttribute("class","form-group"),a&&u.appendChild(this.generateLabel(n+r,a)),d=document.createElement("div"),d.setAttribute("class","col-lg-5"),p=document.createElement("input"),p.setAttribute("type",o),p.setAttribute("name",t+"["+r+"]["+n+"]"),"hidden"!==o&&(s=n+e+r,p.setAttribute("id",s),this.addToAutocomplete(s,t,n)),"checkbox"===o&&i&&p.setAttribute("checked","checked"),p.setAttribute("class","form-control"),"checkbox"!==o?p.setAttribute("value",i):p.setAttribute("value","1"),d.appendChild(p),u.appendChild(d),u},e.prototype.generateEditor=function(e,t,n,r,i,o,a){var d,u,p,s,l,c,m;return"undefined"==typeof i&&(i=""),"undefined"==typeof o&&(o="hidden"),"undefined"==typeof a&&(a=!1),u=document.createElement("div"),u.setAttribute("class","form-group"),a&&u.appendChild(this.generateLabel(n+r,a,"col-lg-1")),d=document.createElement("div"),d.setAttribute("class","col-lg-9"),p=document.createElement("textarea"),p.setAttribute("name",t+"["+r+"]["+n+"]"),s=n+e+r,p.setAttribute("id",s),p.setAttribute("class","form-control"),p.appendChild(document.createTextNode(i)),d.appendChild(p),"undefined"==typeof tinymce&&(m=document.createElement("script"),m.setAttribute("src","tinymce/timymce.min.js"),body.appendChild(m),c=document.createElement("script"),c.setAttribute("src","tinymce/langs/ru.js"),body.appendChild(c)),l=document.createElement("script"),l.appendChild(document.createTextNode("tinymce.init({ selector: '#"+s+"', language: 'ru', height: 300, fontsize_formats: '6pt 7pt 8pt 9pt 10pt 11pt 12pt 13pt 14pt 15pt 16pt 18pt 20pt 24pt 28pt 36pt 40pt 48pt', plugins: [ 'advlist autolink lists link image charmap print preview hr anchor pagebreak', 'searchreplace wordcount visualblocks visualchars code fullscreen', 'insertdatetime media nonbreaking save table contextmenu directionality', 'emoticons template paste textcolor quotes' ], toolbar: [ 'undo redo | fontsizeselect | bold italic underline | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | forecolor backcolor | print preview media' ], image_advtab: true, image_class_list: [ {title: 'Без масштабирования', value: 'no-scale-image'}, {title: 'С масштабированием', value: 'scale-image'} ] });")),d.appendChild(l),u.appendChild(d),u},e.prototype.generateOptions=function(e,t,n,r,i){var o,a,d,u,p,s,l;for("undefined"==typeof i&&(i=""),"undefined"==typeof o&&(o=!1),r=r||t,s=document.createDocumentFragment(),e=e.sort(function(e,t){var n,i;return e[r]?t[r]?(n=e[r].toUpperCase(),i=t[r].toUpperCase(),n>i?1:n<i?-1:0):1:-1}),a=0,d=e.length;a<d;a++)l=e[a],p=l[t],i.length&&(p=l[i]+" - "+p),u=document.createElement("option"),u.setAttribute("value",l.id),u.appendChild(document.createTextNode(p)),Number(l.id)===Number(n)&&u.setAttribute("selected",!0),s.appendChild(u);return s},e.prototype.generateDropdown=function(e,t,n,r,i,o,a,d,u,p){var s,l,c,m,h,b,f,y,g,A;return"undefined"==typeof p&&(p=""),"undefined"==typeof a&&(a=!1),"undefined"==typeof d&&(d=!1),y=document.createElement("div"),s=document.createDocumentFragment(),y.setAttribute("class","form-group"),y.appendChild(this.generateLabel(n+r,i)),l=document.createElement("div"),l.setAttribute("class","col-lg-5"),g=document.createElement("select"),g.setAttribute("name",t+"["+r+"][id]"),g.appendChild(this.generateOptions(o,n,a,u,p)),A=n+e+r,g.setAttribute("id",A),g.setAttribute("class","form-control"),d&&(h=document.createElement("div"),h.setAttribute("class","form-group"),h.appendChild(this.generateLabel("filter"+r,this.translate("filter"))),b=document.createElement("select"),b.setAttribute("id","filter"+r),f=o.filter(function(e,t,n){return!e[d]}),c=document.createElement("option"),c.setAttribute("value",0),c.appendChild(document.createTextNode(this.translate("noFilter"))),b.appendChild(c),b.appendChild(this.generateOptions(f,n,null,u,p)),b.setAttribute("class","form-control"),m=l.cloneNode(),m.appendChild(b),h.appendChild(m),s.appendChild(h),jQuery(b).on("change",function(e){return function(){var t,r,i;return f=function(e,t,n){var r,i,o,a;if(e=Number(e),0===e)return t;if(r=t.filter(function(t){return e===Number(t[n])}),r.length)for(o=0,a=r.length;o<a;o++)i=r[o],r=r.concat(f(i.id,t,n));return r},t=jQuery(b),r=jQuery(g),r.empty(),i=f(t.val(),o,d),g.appendChild(e.generateOptions(i,n,a,u,p))}}(this))),l.appendChild(g),y.appendChild(l),s.appendChild(y),s},e.prototype.generateDateInput=function(e,t,n,r,i,o,a){var d,u,p,s,l;return"undefined"==typeof i&&(i=""),"undefined"==typeof o&&(o="hidden"),"undefined"==typeof a&&(a=!1),u=document.createElement("div"),u.setAttribute("class","form-group"),a&&u.appendChild(this.generateLabel(n+r,a)),d=document.createElement("div"),d.setAttribute("class","col-lg-5 input-group date"),p=document.createElement("input"),p.setAttribute("class","form-control"),p.setAttribute("type",o),p.setAttribute("name",t+"["+r+"]["+n+"]"),p.setAttribute("value",i),s=document.createElement("span"),s.setAttribute("class","input-group-addon"),l=document.createElement("span"),l.setAttribute("class","glyphicon glyphicon-calendar"),s.appendChild(l),d.appendChild(p),d.appendChild(s),u.appendChild(d),$(d).datetimepicker({locale:"ru",viewMode:"years",format:"YYYY-MM-DD"}),u},e.prototype.generateOrder=function(e,t,n){var r,i,o,a,d,u;return a=document.createElement("div"),i=document.createDocumentFragment(),r="order-"+t,a.setAttribute("class","form-group"),a.appendChild(this.generateLabel(t+e+n,this.translate("order"))),o=document.createElement("div"),o.setAttribute("class","col-lg-offset-1 col-lg-3 text-center"),d=document.createElement("select"),d.setAttribute("name",t+"["+n+"][order]"),d.appendChild(this.orderOptions(n)),this.updateOrder(r,n),u=t+e+n,d.setAttribute("id",u),d.setAttribute("class","form-control "+r),o.appendChild(d),a.appendChild(o),i.appendChild(a),this.bindOrderListener(r),i},e.prototype.orderOptions=function(e){var t,n,r,i,o;for(t=document.createDocumentFragment(),n=r=1,o=e;1<=o?r<=o:r>=o;n=1<=o?++r:--r)i=document.createElement("option"),n===e&&i.setAttribute("selected","selected"),i.setAttribute("value",n),i.appendChild(document.createTextNode(n)),t.appendChild(i);return t},e.prototype.updateOrder=function(e,t){var n;n=$("."+e),n.each(function(){var e,n,r,i,o,a,d;if(e=$(this),i=e.children("option").length,i<t){for(d=[],n=r=o=i+1,a=t;o<=a?r<=a:r>=a;n=o<=a?++r:--r)d.push(e.append("<option>"+n+"</option>"));return d}})},e.prototype.bindOrderListener=function(e){return"undefined"==typeof this.ordersListener[e]&&($("body").on("focus click","."+e,function(t){return function(n){return t.ordersListener[e]=n.target.value}}(this)),$("body").on("change","."+e,function(t){return function(n){var r,i;if(i=$(n.target),r=t.ordersListener[e],r!==i.val())return $("."+e).each(function(){var e;if(e=$(this),e.val()===n.target.value&&!e.is(i))return e.val(r)})}}(this))),!0},e.prototype.generateCollapsible=function(e,t,n){var r,i,o,a;return o=e+n,a="section_"+o,i=document.createElement("div"),i.setAttribute("id",a),i.setAttribute("class",e),i.appendChild(document.createTextNode(n+". "+t)),i.appendChild(document.createElement("span")),r=document.createElement("div"),r.appendChild(document.createTextNode("x")),r.setAttribute("id","exit_"+o),r.setAttribute("class","polyfield-exit"),r.setAttribute("title",this.translate("deleteElement")),i.appendChild(r),this.bindClose(o),i},e.prototype.generateContainer=function(e){var t,n;return n=document.createElement("div"),n.setAttribute("class","content"),n.appendChild(document.createElement("div")),n.appendChild(e),t=document.createElement("div"),t.setAttribute("class","container"),t.appendChild(n),t},e.prototype.appendTemplate=function(e){var t,n,r,i,o,a,d,u,p,s,l;if(u=this.models[e],u.counter++,l="section_"+e+u.counter,i=this.generateCollapsible(e,u.label,u.counter),o=document.createElement("p"),u.order&&o.appendChild(this.generateOrder(e,u.name,u.counter)),u.attributeTypes){p=u.attributeTypes;for(n in p)t=p[n],d=function(){switch(!1){case t!==this.inputTypes.STRING:return this.generateInput(e,u.name,n,u.counter,"","text",u.attributeLabels[n]);case t!==this.inputTypes.DATE:return this.generateDateInput(e,u.name,n,u.counter,"","text",u.attributeLabels[n]);case t!==this.inputTypes.TEXT:return this.generateEditor(e,u.name,n,u.counter,"","text",u.attributeLabels[n]);case t!==this.inputTypes.BOOLEAN:return this.generateInput(e,u.name,n,u.counter,"","checkbox",u.attributeLabels[n]);case t!==this.inputTypes.DROPDOWN:return this.generateDropdown(e,u.name,u.dropdownAttribute,u.counter,u.attributeLabels[u.dropdownAttribute],u.dropdownValues,"",u.filterAttribute,u.sortAttribute,u.dropdownPrefixAttribute);default:return document.createElement("div")}}.call(this),o.appendChild(d)}else if(u.type===this.types.STRING||u.type===this.types.DATE){s=u.attributes;for(a in s)n=s[a],indexOf.call(u.dateAttributes,n)>=0?o.appendChild(this.generateDateInput(e,u.name,n,u.counter,"","text",u.attributeLabels[n])):o.appendChild(this.generateInput(e,u.name,n,u.counter,"","text",u.attributeLabels[n]))}else u.type===this.types.DROPDOWN&&o.appendChild(this.generateDropdown(e,u.name,u.dropdownAttribute,u.counter,u.attributeLabels[u.dropdownAttribute],u.dropdownValues,"",u.filterAttribute,u.sortAttribute,u.dropdownPrefixAttribute));return r=document.createDocumentFragment(),r.appendChild(i),r.appendChild(this.generateContainer(o)),document.getElementById("content_"+e).appendChild(r),jQuery("#"+l).collapsible({defaultOpen:""+l}),this.bindAutocomplete()},e.prototype.appendExists=function(e){var t,n,r,i,o,a,d,u,p,s,l,c,m,h,b;if(s=this.models[e],!s.existsShowen){for(c=s.exists,u=0,p=c.length;u<p;u++){if(l=c[u],s.counter++,b="section_"+e+s.counter,r=this.generateCollapsible(e,s.label,s.counter),o=document.createElement("p"),s.order&&o.appendChild(this.generateOrder(e,s.name,s.counter)),s.attributeTypes){m=s.attributeTypes;for(n in m)t=m[n],d=function(){switch(!1){case t!==this.inputTypes.STRING:return this.generateInput(e,s.name,n,s.counter,l[n],"text",s.attributeLabels[n]);case t!==this.inputTypes.DATE:return this.generateDateInput(e,s.name,n,s.counter,l[n],"text",s.attributeLabels[n]);case t!==this.inputTypes.TEXT:return this.generateEditor(e,s.name,n,s.counter,l[n],"text",s.attributeLabels[n]);case t!==this.inputTypes.BOOLEAN:return this.generateInput(e,s.name,n,s.counter,l[n],"checkbox",s.attributeLabels[n]);case t!==this.inputTypes.DROPDOWN:return this.generateDropdown(e,s.name,s.dropdownAttribute,s.counter,s.attributeLabels[s.dropdownAttribute],s.dropdownValues,l.id,s.filterAttribute,s.sortAttribute,s.dropdownPrefixAttribute);default:return document.createElement("div")}}.call(this),o.appendChild(d)}else if(s.type===this.types.STRING||s.type===this.types.DATE||s.type===this.types.TEXT_BLOCK){h=s.attributes;for(a in h)n=h[a],indexOf.call(s.dateAttributes,n)>=0?o.appendChild(this.generateDateInput(e,s.name,n,s.counter,l[n],"text",s.attributeLabels[n])):s.type===this.types.TEXT_BLOCK?o.appendChild(this.generateEditor(e,s.name,n,s.counter,l[n],"text",s.attributeLabels[n])):o.appendChild(this.generateInput(e,s.name,n,s.counter,l[n],"text",s.attributeLabels[n]))}else s.type===this.types.DROPDOWN&&o.appendChild(this.generateDropdown(e,s.name,s.dropdownAttribute,s.counter,s.attributeLabels[s.dropdownAttribute],s.dropdownValues,l.id,s.filterAttribute,s.sortAttribute,s.dropdownPrefixAttribute));i=document.createDocumentFragment(),i.appendChild(r),i.appendChild(this.generateContainer(o)),document.getElementById("content_"+e).appendChild(i),jQuery("#"+b).collapsible({defaultOpen:b}),this.bindAutocomplete()}return s.existsShowen=!0}},e.prototype.bindClose=function(e){return jQuery("body").on("click","#exit_"+e,function(t){return function(){if(confirm(t.translate("deleteConfirmation")))return jQuery("#section_"+e).next().remove(),jQuery("#section_"+e).remove()}}(this))},e.prototype.addToAutocomplete=function(e,t,n){return this.completes.push({id:e,modelName:t,attribute:n})},e.prototype.bindAutocomplete=function(){var e,t,n,r,i,o;for(r=this.completes,e=0,t=r.length;e<t;e++)n=r[e],i=jQuery("#"+n.id),"undefined"==typeof i&&console.error("Bad selector identifier gets for input autocomplete"),o=location.protocol+"//"+location.host+"/content/autocomplete",i.autocomplete({serviceUrl:o,noSuggestionNotice:this.translate("noResults"),deferRequestBy:200,params:{modelName:n.modelName,attributeName:n.attribute}});return this.completes=[]},e.prototype.setTranslation=function(e){return this.i18n=e},e.prototype.translate=function(e){return"undefined"!=typeof this.i18n[e]?this.i18n[e]:e},e}(),window.polyfield=new Polyfield;
>>>>>>> 2473e20a3083ab3485a61837363373dcaa2276c2
